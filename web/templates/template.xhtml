<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>La Playita</title>
        <link rel="icon" type="image/png" href="#{resource['img/la-playita-logo.png']}" />
        <h:outputStylesheet library="css" name="base.css"/>
        <link href="https://cdn.jsdelivr.net/npm/primeicons@7.0.0/primeicons.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    </h:head>
    <h:body>
        <header class="navbar">
            <div class="navbar-left">
                
                <!-- El outcome del logo ahora es dinámico -->
                <h:link outcome="#{loginBean.isLogueado() ? 
                                 (loginBean.usuarioSesion.idRol == 1 ? '/admin/adminHome' : '/home') : 
                                 '/index'}" 
                        styleClass="navbar-logo-link" title="Ir a la página de inicio">
                    <h:graphicImage name="img/la-playita-logo.png" styleClass="logo" alt="Logo La Playita"/>
                </h:link>

                <ul class="navbar-links">

                    <h:panelGroup rendered="#{loginBean.isLogueado()}">

                        <!-- El enlace al panel de admin ya está en el logo, no se necesita aquí. -->

                        <!-- MÓDULOS PARA VENDEDOR (Rol 2) -->
                        <h:panelGroup rendered="#{loginBean.usuarioSesion.idRol == 2}">
                            <!-- El vendedor ahora usa su dashboard en home.xhtml -->
                        </h:panelGroup>

                        <!-- MÓDULOS PARA PRACTICANTE (Rol 3) -->
                        <h:panelGroup rendered="#{loginBean.usuarioSesion.idRol == 3}">
                            <!-- El practicante ahora usa su dashboard en home.xhtml -->
                        </h:panelGroup>

                    </h:panelGroup>
                </ul>
            </div>

            <div class="navbar-right">
                <h:form>

                    <h:panelGroup rendered="#{loginBean.isLogueado()}">
                        <span style="margin-right: 15px; color: #f0f0f0;">Hola, #{loginBean.nombreMostrado}</span>   
                        <p:commandButton value="Cerrar Sesión" action="#{loginBean.logout()}" ajax="false" 
                                         icon="pi pi-sign-out" styleClass="ui-button-warning"/>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{!loginBean.isLogueado()}">
                        <ul class="navbar-links">
                            <li><h:link outcome="/login" value="Login"/></li>
                            <li><h:link outcome="/registro" value="Registro"/></li>
                        </ul>
                    </h:panelGroup>
                </h:form>
            </div>
        </header>

        <main class="main-content">
            <ui:insert name="content"/>
        </main>

        <footer class="footer">
            <p>&#169; 2025 La Playita - Todos los derechos reservados</p>
        </footer>

        <h:outputScript>
            document.addEventListener('DOMContentLoaded', function() {
                const csrfTokenName = '#{csrfBean.paramName}';
                const csrfTokenValue = '#{csrfBean.token}';

                if (csrfTokenName &amp;&amp; csrfTokenValue) {
                    document.querySelectorAll('form').forEach(function(form) {
                        if (!form.querySelector('input[name="' + csrfTokenName + '"]')) {
                            const hiddenInput = document.createElement('input');
                            hiddenInput.setAttribute('type', 'hidden');
                            hiddenInput.setAttribute('name', csrfTokenName);
                            hiddenInput.setAttribute('value', csrfTokenValue);
                            form.appendChild(hiddenInput);
                        }
                    });
                }
            });
        </h:outputScript>
    </h:body>
</html>